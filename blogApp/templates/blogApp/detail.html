{% extends 'global/base.html' %} 
{% block meta %}
    <meta property="og:title" content="{{ post.title }}">
    <meta property="og:image" content="{{ post.thumbnail.url}}">
{% endblock meta %}
{%load static%}
{% block content %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
<link rel="stylesheet" href="{% static 'blogApp/css/detail.css' %}" />


<div class="container">
    <div class="row">
        <div class="p-3 card left top">
            <div class="card-body center px-4">
                <div class="text-center">
                    <h1 style="font-weight: 500">{% block title %} {{ post.title }} {% endblock title %}</h1>
                    <p class="text-muted">
                        {{ post.author }} | {{ post.created_on }}
                    </p>
                </div>
                <div id="thumbnail-section" class="w-100 mx-auto  my-5 text-center">
                    <img class="w-100" src="{{post.thumbnail.url}}">
                </div>
                <div id="text-section" class="card-text-body">
                    <p class="card-text">{{ post.content | safe }}</p>
                </div>
                <div class="comment-section" id="comment-section">
                    <div>
                        {% if user.is_authenticated %}
                            <div class="bg-light py-2 px-3 ml-2 mb-1 likebtn-cover" style="display: inline-block; border-radius: 20px;">
                                <button type="button" id="{{ post.id }}" data-url="{% url 'blogApp:post_like' %}"
                                    class="border-0 likebtn m-0 p-0">
                                    {% if is_liked %}
                                        <svg id="blackThumb" enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512"  width="28" class="thumbs-up" xmlns="http://www.w3.org/2000/svg"><g><path d="m374.706 274.881-58.69 58.69c-5.663 5.663-14.844 5.663-20.506 0l-.707-.707c-5.663-5.663-5.663-14.844 0-20.506l79.903-79.903c8.787-8.787 8.787-23.033 0-31.82s-23.033-8.787-31.82 0l-79.903 79.903c-5.663 5.663-14.844 5.663-20.506 0l-.707-.707c-5.663-5.663-5.663-14.843 0-20.506l101.116-101.116c8.787-8.787 8.787-23.033 0-31.82s-23.033-8.787-31.82 0l-101.116 101.116c-5.663 5.663-14.844 5.663-20.506 0s-5.663-14.844 0-20.506l79.903-79.903c8.787-8.787 8.787-23.033 0-31.82s-23.033-8.787-31.82 0c-17.731 17.732-161.769 161.769-167.76 167.76-4.328-35.356-9.773-88.882-9.776-88.917v.001c0-8.432-3.532-16.865-10.598-22.887-18.809-16.03-48.771-3.356-49.393 22.149 8.778 149.228-17.396 229.12 51.204 297.721 46.863 46.863 133.449 57.47 180.312 10.607l175.009-175.009c8.787-8.787 8.787-23.033 0-31.82s-23.033-8.787-31.819 0z"/><path d="m29.98 114.14c12.5 0 24.64 3.89 34.71 11.02-2.37-21.89-4.19-39.73-4.19-39.73 0-.01 0-.01 0-.02-.01-8.42-3.54-16.84-10.6-22.86-18.813-16.042-48.774-3.352-49.39 22.15.74 12.59 1.23 24.68 1.55 36.31 8.54-4.48 18.13-6.87 27.92-6.87z"/><path d="m92.62 197.76 123.69-123.7c8.97-8.96 20.6-14.28 33.12-15.22l20.43-20.43c8.78-8.79 8.78-23.03 0-31.82-8.82-8.8-23.048-8.772-31.82 0-14.29 14.28-110.47 110.47-150.51 150.51 1.45 4.91 2.28 10.02 2.43 15.24.35 3.34 1.34 13 2.66 25.42z"/><path d="m303.5 95.31c6.03-3.02 12.61-4.85 19.46-5.35l20.44-20.44c8.78-8.78 8.78-23.03 0-31.82-8.78-8.76-23.034-8.786-31.82 0l-29.48 29.48c9.754 6.362 17.64 16.203 21.4 28.13z"/><path d="m497 92h-30c-8.284 0-15 6.716-15 15s6.716 15 15 15h30c8.284 0 15-6.716 15-15s-6.716-15-15-15z"/><path d="m476.606 4.393c-5.857-5.858-15.355-5.858-21.213 0l-30 30c-5.858 5.858-5.858 15.355 0 21.213s15.356 5.858 21.213 0l30-30c5.859-5.857 5.859-15.355 0-21.213z"/></g></svg>
                                        <svg id="whiteThumb" enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512" width="28" class="thumbs-up hide" xmlns="http://www.w3.org/2000/svg"><g><path d="m.046 186.268c2.362 40.153 2.164 73.45 1.989 102.828-.463 77.888-1.188 128.634 53.583 183.405 52.635 52.634 138.281 52.638 190.919 0 .001-.001.001-.002.002-.003l148.49-148.49c17.586-17.585 17.589-46.052 0-63.64-3.717-3.717-7.929-6.647-12.424-8.789l24.61-24.61c17.545-17.545 17.545-46.093 0-63.64-4.138-4.138-8.892-7.287-13.966-9.474 9.782-17.038 7.56-39.359-7.248-54.166-3.919-3.919-8.389-6.956-13.161-9.124 11.113-17.235 9.352-40.728-6.052-56.131-14.652-14.652-36.972-17.057-54.141-7.253-2.225-5.144-5.416-9.878-9.499-13.96-17.544-17.545-46.094-17.546-63.62-.019-.912.908-79.383 79.095-129.632 129.272l-7.715-54.548c-.608-24.27-20.441-43.842-44.984-43.842-24.57 0-44.397 19.602-44.986 43.899-.011.415-.003.831.021 1.245 1.201 20.398 1.852 40.931 2.031 64.055-10.122 9.483-14.782 22.978-14.217 32.985zm373.77 116.528-148.492 148.492c-40.938 40.939-107.553 40.94-148.493 0-45.489-45.489-45.257-84.431-44.796-162.014.176-29.656.376-63.243-1.998-104.036.751-12.837 16.455-18.847 25.581-9.721 5.089 5.089 3.14 7.279 4.543 12.718.003.027.007.054.012.08l12.04 85.142c1.73 12.22 16.722 17.247 25.46 8.505 25.89-25.894-2.714 2.694 149.295-149.261 5.875-5.439 15.071-5.32 20.782.39 5.863 5.863 5.863 15.35 0 21.213-.002.002-.003.004-.005.006l-63.635 63.634c-5.858 5.858-5.858 15.355 0 21.213 5.856 5.858 15.354 5.858 21.213 0 4.98-4.98 79.894-79.893 84.854-84.853 5.85-5.848 15.365-5.848 21.212.001 5.863 5.863 5.863 15.35 0 21.213 0 0-79.883 79.883-84.853 84.853-5.858 5.858-5.858 15.355 0 21.213 5.857 5.858 15.355 5.858 21.213 0l63.64-63.64c5.85-5.849 15.367-5.848 21.213 0 5.849 5.849 5.85 15.365.001 21.213-10.59 10.59-59.02 59.02-63.64 63.64-5.858 5.858-5.858 15.355 0 21.213 5.857 5.858 15.355 5.858 21.213 0l42.502-42.502c5.856-5.773 15.314-5.747 21.138.075 5.863 5.862 5.863 15.35 0 21.213zm-9.027-181.892c5.863 5.863 5.863 15.35 0 21.213l-3.385 3.385c-2.177-4.547-5.131-8.742-8.802-12.412-3.67-3.67-7.864-6.624-12.412-8.801l3.393-3.392c5.849-5.841 15.361-5.839 21.206.007zm21.214 84.853-3.405 3.405c-2.142-4.497-5.063-8.713-8.782-12.432-3.718-3.718-7.934-6.64-12.431-8.782l3.404-3.404c5.85-5.849 15.367-5.848 21.213-.001 5.848 5.849 5.849 15.365.001 21.214zm-40.427-150.108c5.845 5.845 5.868 15.305.037 21.176-1.912 1.897 11.052-10.964-47.849 47.465-2.177-4.547-5.131-8.742-8.802-12.413-3.686-3.686-7.862-6.587-12.315-8.725 2.673-2.661 46.048-45.844 47.714-47.504 5.853-5.849 15.367-5.847 21.215.001zm-235.717 129.274c44.802-44.809 149.789-149.417 150.863-150.487 5.851-5.849 15.365-5.848 21.214 0 5.596 5.596 5.803 14.393.882 20.241-140.276 139.994 65.966-66.279-185.109 184.82l-7.53-53.243c6.008 4.567 14.402 3.949 19.68-1.331zm-67.636-96.725c.748-12.834 16.456-18.844 25.581-9.72 5.089 5.09 3.139 7.278 4.542 12.717.004.028 9.836 69.552 9.836 69.552-8.819-12.86-23.16-19.871-38.055-19.581-.286-18.664-.908-35.858-1.904-52.968z"/><path d="m497.02 92.042h-30c-8.284 0-15 6.716-15 15s6.716 15 15 15h30c8.284 0 15-6.716 15-15s-6.715-15-15-15z"/><path d="m446.627 55.648 30-30c5.858-5.858 5.858-15.355 0-21.213-5.857-5.858-15.355-5.858-21.213 0l-30 30c-5.858 5.858-5.858 15.355 0 21.213 5.857 5.858 15.355 5.859 21.213 0z"/></g></svg>
                                    {% else %}
                                        <svg id="blackThumb" enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512"  width="28" class="thumbs-up hide" xmlns="http://www.w3.org/2000/svg"><g><path d="m374.706 274.881-58.69 58.69c-5.663 5.663-14.844 5.663-20.506 0l-.707-.707c-5.663-5.663-5.663-14.844 0-20.506l79.903-79.903c8.787-8.787 8.787-23.033 0-31.82s-23.033-8.787-31.82 0l-79.903 79.903c-5.663 5.663-14.844 5.663-20.506 0l-.707-.707c-5.663-5.663-5.663-14.843 0-20.506l101.116-101.116c8.787-8.787 8.787-23.033 0-31.82s-23.033-8.787-31.82 0l-101.116 101.116c-5.663 5.663-14.844 5.663-20.506 0s-5.663-14.844 0-20.506l79.903-79.903c8.787-8.787 8.787-23.033 0-31.82s-23.033-8.787-31.82 0c-17.731 17.732-161.769 161.769-167.76 167.76-4.328-35.356-9.773-88.882-9.776-88.917v.001c0-8.432-3.532-16.865-10.598-22.887-18.809-16.03-48.771-3.356-49.393 22.149 8.778 149.228-17.396 229.12 51.204 297.721 46.863 46.863 133.449 57.47 180.312 10.607l175.009-175.009c8.787-8.787 8.787-23.033 0-31.82s-23.033-8.787-31.819 0z"/><path d="m29.98 114.14c12.5 0 24.64 3.89 34.71 11.02-2.37-21.89-4.19-39.73-4.19-39.73 0-.01 0-.01 0-.02-.01-8.42-3.54-16.84-10.6-22.86-18.813-16.042-48.774-3.352-49.39 22.15.74 12.59 1.23 24.68 1.55 36.31 8.54-4.48 18.13-6.87 27.92-6.87z"/><path d="m92.62 197.76 123.69-123.7c8.97-8.96 20.6-14.28 33.12-15.22l20.43-20.43c8.78-8.79 8.78-23.03 0-31.82-8.82-8.8-23.048-8.772-31.82 0-14.29 14.28-110.47 110.47-150.51 150.51 1.45 4.91 2.28 10.02 2.43 15.24.35 3.34 1.34 13 2.66 25.42z"/><path d="m303.5 95.31c6.03-3.02 12.61-4.85 19.46-5.35l20.44-20.44c8.78-8.78 8.78-23.03 0-31.82-8.78-8.76-23.034-8.786-31.82 0l-29.48 29.48c9.754 6.362 17.64 16.203 21.4 28.13z"/><path d="m497 92h-30c-8.284 0-15 6.716-15 15s6.716 15 15 15h30c8.284 0 15-6.716 15-15s-6.716-15-15-15z"/><path d="m476.606 4.393c-5.857-5.858-15.355-5.858-21.213 0l-30 30c-5.858 5.858-5.858 15.355 0 21.213s15.356 5.858 21.213 0l30-30c5.859-5.857 5.859-15.355 0-21.213z"/></g></svg>
                                        <svg id="whiteThumb" enable-background="new 0 0 512 512" height="512" viewBox="0 0 512 512" width="28" class="thumbs-up" xmlns="http://www.w3.org/2000/svg"><g><path d="m.046 186.268c2.362 40.153 2.164 73.45 1.989 102.828-.463 77.888-1.188 128.634 53.583 183.405 52.635 52.634 138.281 52.638 190.919 0 .001-.001.001-.002.002-.003l148.49-148.49c17.586-17.585 17.589-46.052 0-63.64-3.717-3.717-7.929-6.647-12.424-8.789l24.61-24.61c17.545-17.545 17.545-46.093 0-63.64-4.138-4.138-8.892-7.287-13.966-9.474 9.782-17.038 7.56-39.359-7.248-54.166-3.919-3.919-8.389-6.956-13.161-9.124 11.113-17.235 9.352-40.728-6.052-56.131-14.652-14.652-36.972-17.057-54.141-7.253-2.225-5.144-5.416-9.878-9.499-13.96-17.544-17.545-46.094-17.546-63.62-.019-.912.908-79.383 79.095-129.632 129.272l-7.715-54.548c-.608-24.27-20.441-43.842-44.984-43.842-24.57 0-44.397 19.602-44.986 43.899-.011.415-.003.831.021 1.245 1.201 20.398 1.852 40.931 2.031 64.055-10.122 9.483-14.782 22.978-14.217 32.985zm373.77 116.528-148.492 148.492c-40.938 40.939-107.553 40.94-148.493 0-45.489-45.489-45.257-84.431-44.796-162.014.176-29.656.376-63.243-1.998-104.036.751-12.837 16.455-18.847 25.581-9.721 5.089 5.089 3.14 7.279 4.543 12.718.003.027.007.054.012.08l12.04 85.142c1.73 12.22 16.722 17.247 25.46 8.505 25.89-25.894-2.714 2.694 149.295-149.261 5.875-5.439 15.071-5.32 20.782.39 5.863 5.863 5.863 15.35 0 21.213-.002.002-.003.004-.005.006l-63.635 63.634c-5.858 5.858-5.858 15.355 0 21.213 5.856 5.858 15.354 5.858 21.213 0 4.98-4.98 79.894-79.893 84.854-84.853 5.85-5.848 15.365-5.848 21.212.001 5.863 5.863 5.863 15.35 0 21.213 0 0-79.883 79.883-84.853 84.853-5.858 5.858-5.858 15.355 0 21.213 5.857 5.858 15.355 5.858 21.213 0l63.64-63.64c5.85-5.849 15.367-5.848 21.213 0 5.849 5.849 5.85 15.365.001 21.213-10.59 10.59-59.02 59.02-63.64 63.64-5.858 5.858-5.858 15.355 0 21.213 5.857 5.858 15.355 5.858 21.213 0l42.502-42.502c5.856-5.773 15.314-5.747 21.138.075 5.863 5.862 5.863 15.35 0 21.213zm-9.027-181.892c5.863 5.863 5.863 15.35 0 21.213l-3.385 3.385c-2.177-4.547-5.131-8.742-8.802-12.412-3.67-3.67-7.864-6.624-12.412-8.801l3.393-3.392c5.849-5.841 15.361-5.839 21.206.007zm21.214 84.853-3.405 3.405c-2.142-4.497-5.063-8.713-8.782-12.432-3.718-3.718-7.934-6.64-12.431-8.782l3.404-3.404c5.85-5.849 15.367-5.848 21.213-.001 5.848 5.849 5.849 15.365.001 21.214zm-40.427-150.108c5.845 5.845 5.868 15.305.037 21.176-1.912 1.897 11.052-10.964-47.849 47.465-2.177-4.547-5.131-8.742-8.802-12.413-3.686-3.686-7.862-6.587-12.315-8.725 2.673-2.661 46.048-45.844 47.714-47.504 5.853-5.849 15.367-5.847 21.215.001zm-235.717 129.274c44.802-44.809 149.789-149.417 150.863-150.487 5.851-5.849 15.365-5.848 21.214 0 5.596 5.596 5.803 14.393.882 20.241-140.276 139.994 65.966-66.279-185.109 184.82l-7.53-53.243c6.008 4.567 14.402 3.949 19.68-1.331zm-67.636-96.725c.748-12.834 16.456-18.844 25.581-9.72 5.089 5.09 3.139 7.278 4.542 12.717.004.028 9.836 69.552 9.836 69.552-8.819-12.86-23.16-19.871-38.055-19.581-.286-18.664-.908-35.858-1.904-52.968z"/><path d="m497.02 92.042h-30c-8.284 0-15 6.716-15 15s6.716 15 15 15h30c8.284 0 15-6.716 15-15s-6.715-15-15-15z"/><path d="m446.627 55.648 30-30c5.858-5.858 5.858-15.355 0-21.213-5.857-5.858-15.355-5.858-21.213 0l-30 30c-5.858 5.858-5.858 15.355 0 21.213 5.857 5.858 15.355 5.859 21.213 0z"/></g></svg>
                                    {%endif%}
                                </button>
                                <span id="like_count{{post.id}}" class="like_count mt-5 pl-2">{{total_like}}</span>             
                            </div>
                            <form  method="post" style="margin-top: 1.3em">
                                <div class="form-group">
                                    {% csrf_token %}
                                    {{ comment_form.as_p }}
                                    <button type="submit" class="btn btn-md comment-submit">
                                        Comment
                                    </button>
                                </div>  
                            </form>
                            {% else %}
                            <a class="btn btn-outline-info mb-5" href="{% url 'authenticationApp:login' %}?next={{request.path}}">Log in to add a comment!</a><br>
                        {% endif %}
                    </div>
                    <h3>comment:</h3>
                    {% for comment in comments %}
                    <div class="comments" style="padding: 10px">
                        <p class="font-weight-bold">
                            {{ comment.name }}
                            <span class="text-muted font-weight-normal">
                                {{ comment.created_on }}
                            </span>
                        </p>
                        {{ comment.author | linebreaks }}
                        {{ comment.body | linebreaks }}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    <div>
        {% if authorProfile %}
            {% include 'blogApp/includes/sidebar.html' with author=authorProfile post=post %}
        {% endif %}
    </div>
</div>
<script src="{% static 'blogApp/js/detail.js' %}"></script>
<script>
    $(document).ready(function () {
        $(".likebtn").click(function (event) {
            event.preventDefault()
            var ansid = $(this).attr('id');
            console.log(ansid)
            $.ajax({
                url: $(this).data('url'),
                type: 'POST',
                data: {
                    'post_id': ansid,
                    'csrfmiddlewaretoken': "{{ csrf_token }}",
                    'action': 'post'
                },
                success: function (response) {
                    $('#like_count' + ansid).text(response['total_like']);
                    if (response['flag']) {
                        $('#whiteThumb').addClass('hide');
                        $('#blackThumb').removeClass('hide');
                        $('#' + ansid).addClass('text-primary');
                    } else {
                        $('#blackThumb').addClass('hide');
                        $('#whiteThumb').removeClass('hide');
                        $('#' + ansid).removeClass('text-primary');
                    }
                },
                error: function (rs, e) {
                    console.log(rs.response)
                }
            });
        });
    });

</script>
{% endblock content %}